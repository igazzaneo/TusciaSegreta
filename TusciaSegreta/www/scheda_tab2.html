<ons-page id="Scelta">

    <div id="mapid3" style="width: 100%; height: 50%;"></div>
    <div id="elevation-div" style="width: 100%; height: 35%;"></div>
    <br/>
    <div>
      <ons-list>
        <ons-list-item>
          <ons-row>
            <ons-col width="50px"><ons-icon icon="fa-arrow-right" class="list-item__icon"></ons-icon></ons-col>
            <ons-col>Lunghezza: 2,1 Km</ons-col>
            <ons-col width="50px"><ons-icon icon="fa-arrow-up" class="list-item__icon"></ons-icon></ons-col>
            <ons-col>Dislivello: 50m</ons-col>
          </ons-row>
        </ons-list-item>

        <ons-list-item>
          <ons-row>
            <ons-col width="50px"><ons-icon icon="fa-play" rotate="270" class="list-item__icon"></ons-icon></ons-col>
            <ons-col>Difficolt√†: Facile</ons-col>
            <ons-col width="50px"><ons-icon modifier="other" icon="fa-clock" class="list-item__icon"></ons-icon></ons-col>
            <ons-col>Durata prevista: 25 m</ons-col>
          </ons-row>
        </ons-list-item>

        <ons-list-item>
          <ons-row>
            <ons-col width="50px"><ons-icon icon="fa-undo-alt" class="list-item__icon"></ons-icon></ons-col>
            <ons-col>Percorso ad anello: NO</ons-col>
          </ons-row>
        </ons-list-item>

        <ons-list-item>
          <ons-row>
            <ons-col width="50px"><ons-icon icon="fa-battery-three-quarters" rotate="270" class="list-item__icon"></ons-icon></ons-col>
            <ons-col>Batteria: consigliati caricatori</ons-col>
            <ons-col width="50px"><ons-icon modifier="other" icon="fa-wifi" class="list-item__icon"></ons-icon></ons-col>
            <ons-col>Rete mobile: assente</ons-col>
          </ons-row>
        </ons-list-item>
      </ons-list>
    </div>
    <br>
    <div id="commenti">
      <div>
        <table style="width: 100%;">
        <tbody>
          <tr><td>test ha detto:</td></tr>
          <tr><td>Testo del commento</td></tr>
          <tr><td><div id='trail-rating'><ul class='ratings'><li class='average'><span id='rating' class='rating star3_5'>&nbsp;</span></li></ul></div></td></tr>
        </tbody>
        </table>
      </div>
      <div><hr class="style-three"></div>
    </div>

  <script>

    var roads = L.gridLayer.googleMutant({
       type: 'roadmap'	// valid values are 'roadmap', 'satellite', 'terrain' and 'hybrid'
    })

    var satellite = L.gridLayer.googleMutant({
       type: 'satellite'	// valid values are 'roadmap', 'satellite', 'terrain' and 'hybrid'
    })

    var terrain = L.gridLayer.googleMutant({
       type: 'terrain'	// valid values are 'roadmap', 'satellite', 'terrain' and 'hybrid'
    })

    var hybrid = L.gridLayer.googleMutant({
       type: 'hybrid'	// valid values are 'roadmap', 'satellite', 'terrain' and 'hybrid'
    })

    var map = new L.Map('mapid3',{
        center: new L.LatLng(42.585280, 11.933396),
        zoom: 9,
        layers: [roads]
    });

    var baseLayers = {
        "Standard": roads,
        "Satellite": satellite,
        "Altimetria": terrain,
        "Ibrido": hybrid
    };

    L.control.layers(baseLayers).addTo(map);

    var percorso = localStorage.getObj("percorso");
//showMessage(percorso[3]);
    var elevationControl = {
      //url: "https://raruto.github.io/examples/leaflet-elevation/via-emilia.gpx",
      url: "gpx/eremo-di-poggio-conte2.gpx",
      //url: percorso[3],
      options: {
        position: "topleft",
        theme: "magenta-theme", //default: lime-theme
        useHeightIndicator: true, //if false a marker is drawn at map position
        interpolation: d3.curveLinear, //see https://github.com/d3/d3/wiki/
        collapsed: false, //collapsed mode, show chart on click or mouseover
        elevationDiv: "#elevation-div",
        detachedView: true,
        responsiveView: true,
      },
    };

    var controlElevation = L.control.elevation(elevationControl.options);
    controlElevation.loadGPX(map, elevationControl.url);

    //var gpx = 'gpx/eremo-di-poggio-conte2.gpx'; // URL to your GPX file or the GPX itself

    var options = {
      icon: 'fas fa-map-pin',
      iconShape: 'marker',
      borderColor: '#000000',
      borderWidth: 2,
      iconSize: [25, 25],
      popupAnchor: [-1, -32],
      textColor: '#000000'
    };

    var startOptions = {
      icon: 'fas fa-flag',
      iconShape: 'marker',
      borderColor: '#000000',
      borderWidth: 2,
      iconSize: [35, 35],
      popupAnchor: [-1, -32],
      textColor: '#00FF00',
      customClasses: 'fa-2x'
    };

    var endOptions = {
      icon: 'fas fa-flag-checkered',
      iconShape: 'marker',
      borderColor: '#000000',
      borderWidth: 2,
      iconSize: [35, 35],
      popupAnchor: [-1, -32],
      textColor: '#FF0000',
      customClasses: 'fa-2x'
    };

    //console.log("GPX FILE:"  + gpx);
    /*new L.GPX(gpx, {
      async: true,
      marker_options: {
        startIconUrl: 'img/pin-icon-start.png',
        endIconUrl: 'img/pin-icon-end.png',
        shadowUrl: 'img/pin-shadow.png',

        wptIcons: {
          '': new L.BeautifyIcon.icon(options)
        }
      }
    }).on('loaded', function(e) {
      console.log("loaded");
      var gpx = e.target;
      mymap.fitBounds(gpx.getBounds());
      control.addOverlay(gpx, gpx.get_name());
    }).addTo(mymap);*/
    var current_position, current_accuracy;

    function onLocationFound(e) {
      // if position defined, then remove the existing position marker and accuracy circle from the map
      if (current_position) {
          map.removeLayer(current_position);
          map.removeLayer(current_accuracy);
      }

      var radius = e.accuracy / 2;

      current_position = L.marker(e.latlng).addTo(map)
        .bindPopup("You are within " + radius + " meters from this point").openPopup();

      current_accuracy = L.circle(e.latlng, radius).addTo(map);
    }

    function onLocationError(e) {
      alert(e.message);
    }

    map.on('locationfound', onLocationFound);
    map.on('locationerror', onLocationError);

    // wrap map.locate in a function
    function locate() {
      map.locate({setView: true, maxZoom: 16});
    }

    // call locate every 3 seconds... forever
    setInterval(locate, 3000);

    /*function getPosizioneAttuale(e) {

      var current_position, current_accuracy;

      if (current_position) {
          map.removeLayer(current_position);
          map.removeLayer(current_accuracy);
      }

      var options = {
        icon: 'fas fa-map-marker-alt',

        borderColor: '#000000',
        borderWidth: 1,
        iconSize: [20, 20],

        popupAnchor: [15, -7],

      };

      getMapLocation();

      current_position = L.marker(e.latlng, {
        icon: L.BeautifyIcon.icon(options),
        draggable: false}).addTo(map).bindPopup("Sei " + radius + " m dal punto").openPopup();

      current_accuracy = L.circle(e.latlng, radius).addTo(map);

      var nodi = localStorage.getObj("nodi");
//showMessage(nodi);

     for(var x=0; x<nodi.length; x++) {

        var nodo = nodi[x];

        var to = L.marker([nodo[1], nodo[2]);

        var distanzaInMetri = current_position.getLatLng().distanceTo(to.getLatLng());

        if(distanzaInMetri<20) {
          showMessage("Hai raggiunto PDI: " + nodo[5]);
        }
      }


        setTimeout(getPosizioneAttuale, 3000);
    }


    getPosizioneAttuale();
*/
    </script>
</ons-page>
